<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.5/axios.min.js"></script>
    <style>
        table,
        th,
        td {
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <div class="container">
        <form id="my-form">
            <div class="form-floating">
                <input type="number" id="amount" class="form-control" placeholder="expence amount">
                <label for="amount" class="form-label">Choose Expense amount:</label>

            </div>
            <div class="form-floating">
                <input type="text" id="description" class="form-control" placeholder="expence description">
                <label for="description" class="form-label">Choose Expense description:</label>

            </div>
            <div class="form-floating">
                <input type="text" id="category" class="form-control" placeholder="expence category">
                <label for="category" class="form-label">Choose a category:</label>

            </div>
            <button type="submit" id='btn' class="btn btn-primary">Add expense</button>
        </form>
        <table style="width:100%" id="table">
            <tr></tr>
                <th>Amount</th>
                <th>Description</th>
                <th>Category</th>
                <th>Delete here</th>
                <th>Edit</th>
            </tr>
        </table>
    </div>
    <span id="editid" class="d-none"></span>


</body>
<script>
    const submit = document.getElementById('btn');

    submit.addEventListener('click', async (e) => {
        try {
            e.preventDefault();
            const amount = document.getElementById('amount').value;
            const description = document.getElementById('description').value;
            const category = document.getElementById('category').value;
            const obj = {
                amount,
                description,
                category
            }
            // console.log(obj);
            if(editid.textContent) {
                const res = await axios.post(`http://localhost:3000/edit-expense/${editid.textContent}`, obj);
                showOutput(res.data.editedExpense)
                console.log(res)
            } else {
                const res = await axios.post('http://localhost:3000/add-expense', obj);
                showOutput(res.data.newExpense)
            }
            // console.log(res.data);
            
        }
        catch (err) {
            console.log(err);
        }
    });

    document.addEventListener('DOMContentLoaded', async function allExpense() {
        try {
            const res = await axios.get('http://localhost:3000/get-expenses')
            console.log(res.data);
            res.data.expenses.forEach((element) => {
                showOutput(element);
            })
        }
        catch (err) {
            console.log(err);
        }
    })

    function showOutput(data) {
        document.getElementById('amount').value = "";
        document.getElementById('description').value = "";
        document.getElementById('category').value = "";
        console.log(data.amount);

        const table = document.getElementById('table');
        let row = table.insertRow(-1);
        row.id = `${data.id}`

        let c1 = row.insertCell(0);
        let c2 = row.insertCell(1);
        let c3 = row.insertCell(2);
        let c4 = row.insertCell(3);
        let c5 = row.insertCell(4);

        c1.innerText = data.amount;
        c2.innerText = data.description;
        c3.innerText = data.category;
        c4.innerHTML = `<button class="btn btn-danger" onclick="deleteExpense('${data.id}')">Delete</button>`;
        c5.innerHTML = `<button style="color: green" onclick="editExpense('${data.id}')">Edit</button>`
    }

    async function deleteExpense(id) {
        try {
            alert('are you sure to delete');
            const res = await axios.delete(`http://localhost:3000/delete-expense/${id}`)
            console.log(res.data);

            const table = document.getElementById('table');
            const expense = document.getElementById(`${id}`);
            table.deleteRow(expense.rowIndex);
        }
        catch (err) {
            console.log(err);
        }
    }

    async function editExpense(id) {
        try {
            const res = await axios.get(`http://localhost:3000/get-expense/${id}`);
            const expense = res.data.expense;
            editid.textContent=id
            document.getElementById('amount').value=expense.amount;
            document.getElementById('description').value = expense.description;
            document.getElementById('category').value = expense.category;
            const table = document.getElementById('table');
            const expens = document.getElementById(`${id}`);
            table.deleteRow(expens.rowIndex);
            
            // const exps = await axios.post(`http://localhost:3000/edit-expense/$`);
            
        }
        catch(err) {
            console.log(err);
        }
    }

</script>

</html>