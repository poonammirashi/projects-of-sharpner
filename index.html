<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.5/axios.min.js"></script>
</head>
<body>
    <form id="my-form">
        <label for="price">Selling Prize</label>
        <input type="number" id="price" name="price">
        <label for="name">Product Name</label>
        <input type="text" id="name" name="name">
        <button type="submit" >Add Product</button>
    </form>
    <h2>Products</h2>
    <ul id="products">
    
    </ul>
    <div id="total"  >
        <!-- <h2>Total value worth of products: Rs ${price} </h2> -->
    </div>
    <script>
        var totalprice = 0;
        window.addEventListener('DOMContentLoaded', async() => {
            try{
                products = await axios.get('http://localhost:3000/get-products');
                console.log(products.data.products)
                products.data.products.forEach(ele => {
                    totalprice += ele.price;
                    console.log(totalprice);
                    showProductOnScreen(ele);
                })
                total.innerHTML = `<h2>Total value worth of products: Rs ${totalprice} </h2>` 
            }
            catch(err) {
                console.log(err)
            }
        });

        let form = document.getElementById('my-form');

        form.addEventListener('submit', async (e) => {
            try{
                e.preventDefault();
                let price = document.getElementById('price').value ;
                let name = document.getElementById('name').value;
                let total = document.getElementById('total');
                console.log(total);
                product = await axios.post('http://localhost:3000/add-product', {price,name})
                totalprice +=parseInt(price);
                showProductOnScreen(product.data.newproduct);  
                total.innerHTML = `<h2>Total value worth of products: Rs ${totalprice} </h2>`              
           }
            catch(err) {
                console.log(err);
            }
        });

        function showProductOnScreen(product) {
            document.getElementById('price').value = "";
            document,getElementById('name').value = "";
            let child = `<li id='${product.id}'>${product.price}--${product.name} 
                <button type='submit' onclick="deleteProduct(${product.id},${product.price})">Delete</button></li>`;
            let parent = document.getElementById('products');
            parent.innerHTML += child;
        }

        async function deleteProduct (id,productprice) {
            try{
                let product = await axios.delete(`http://localhost:3000/delete-product/${id}`)
                console.log(product,  totalprice);
                totalprice -= productprice ;
                let child= document.getElementById(`${id}`)
                parent = document.getElementById('products');
                parent.removeChild(child);
                total.innerHTML = `<h2>Total value worth of products: Rs${totalprice}</h2>`
            }
            catch(err) {
                console.log(err);
            }
        }
    </script>
</body>
</html>